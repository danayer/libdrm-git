- name: Get latest version and commit from upstream
  run: |
    # Получаем последний тег libdrm
    LATEST_TAG=$(curl -s "https://gitlab.freedesktop.org/api/v4/projects/10539/repository/tags" \
                 | jq -r '.[0].name')

    if [ -z "$LATEST_TAG" ]; then
      echo "Error: could not fetch latest tag"
      exit 1
    fi

    LATEST_LIB_VERSION=$(echo "$LATEST_TAG" | grep -oP '\d+\.\d+\.\d+' | cut -d'.' -f3)

    # Последний коммит
    LATEST_COMMIT=$(curl -s "https://gitlab.freedesktop.org/api/v4/projects/10539/repository/commits" \
                  | jq -r '.[0].id')
    SHORTCOMMIT=${LATEST_COMMIT:0:7}

    echo "LATEST_LIB_VERSION=$LATEST_LIB_VERSION" >> $GITHUB_ENV
    echo "LATEST_COMMIT=$LATEST_COMMIT" >> $GITHUB_ENV
    echo "SHORTCOMMIT=$SHORTCOMMIT" >> $GITHUB_ENV
